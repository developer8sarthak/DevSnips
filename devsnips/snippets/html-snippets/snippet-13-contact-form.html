<!--
  Mobile-friendly Contact Form Layout
  - Responsive grid layout
  - Custom form validation
  - Success/error states
  - Accessible form controls
  - Touch-friendly inputs
-->

<form class="contact-form" novalidate>
  <h2>Contact Us</h2>
  
  <div class="form-grid">
    <div class="form-group">
      <label for="name">Full Name</label>
      <input 
        type="text" 
        id="name" 
        name="name" 
        required 
        minlength="2"
        aria-describedby="name-error"
      >
      <div id="name-error" class="error-message" aria-live="polite"></div>
    </div>

    <div class="form-group">
      <label for="email">Email Address</label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        required
        aria-describedby="email-error"
      >
      <div id="email-error" class="error-message" aria-live="polite"></div>
    </div>

    <div class="form-group">
      <label for="phone">Phone Number</label>
      <input 
        type="tel" 
        id="phone" 
        name="phone" 
        pattern="[0-9]{10}"
        aria-describedby="phone-error"
      >
      <div id="phone-error" class="error-message" aria-live="polite"></div>
    </div>

    <div class="form-group">
      <label for="subject">Subject</label>
      <select 
        id="subject" 
        name="subject" 
        required
        aria-describedby="subject-error"
      >
        <option value="">Select a subject</option>
        <option value="general">General Inquiry</option>
        <option value="support">Technical Support</option>
        <option value="feedback">Feedback</option>
        <option value="other">Other</option>
      </select>
      <div id="subject-error" class="error-message" aria-live="polite"></div>
    </div>

    <div class="form-group full-width">
      <label for="message">Message</label>
      <textarea 
        id="message" 
        name="message" 
        required 
        minlength="10"
        rows="5"
        aria-describedby="message-error"
      ></textarea>
      <div id="message-error" class="error-message" aria-live="polite"></div>
    </div>

    <div class="form-group full-width">
      <label class="checkbox-label">
        <input 
          type="checkbox" 
          id="consent" 
          name="consent" 
          required
          aria-describedby="consent-error"
        >
        <span>I agree to the processing of my personal data</span>
      </label>
      <div id="consent-error" class="error-message" aria-live="polite"></div>
    </div>
  </div>

  <button type="submit" class="submit-button" disabled>
    <span class="button-text">Send Message</span>
    <span class="button-loader" hidden></span>
  </button>

  <div class="form-message" role="status" aria-live="polite"></div>
</form>

<style>
.contact-form {
  max-width: 800px;
  margin: 2rem auto;
  padding: 2rem;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.contact-form h2 {
  margin: 0 0 1.5rem;
  color: #333;
}

.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
  margin-bottom: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.full-width {
  grid-column: 1 / -1;
}

label {
  font-weight: 500;
  color: #333;
}

input,
select,
textarea {
  padding: 0.75rem;
  border: 2px solid #ddd;
  border-radius: 4px;
  font-size: 1rem;
  transition: all 0.3s;
  width: 100%;
}

select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24'%3E%3Cpath d='M7 10l5 5 5-5H7z' fill='%23666'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.5rem center;
  padding-right: 2.5rem;
}

textarea {
  resize: vertical;
  min-height: 100px;
}

.checkbox-label {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  font-weight: normal;
}

input[type="checkbox"] {
  width: auto;
  margin-top: 0.25rem;
}

.error-message {
  font-size: 0.875rem;
  color: #f44336;
  min-height: 1.25rem;
}

.submit-button {
  position: relative;
  width: 100%;
  padding: 0.875rem;
  border: none;
  border-radius: 4px;
  background: #4a90e2;
  color: white;
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.3s;
}

.submit-button:hover:not(:disabled) {
  background: #357abd;
}

.submit-button:disabled {
  background: #ddd;
  cursor: not-allowed;
}

.button-loader {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 20px;
  height: 20px;
  margin-top: -10px;
  margin-left: -10px;
  border: 2px solid #fff;
  border-radius: 50%;
  border-top-color: transparent;
  animation: spin 0.6s linear infinite;
}

.form-message {
  margin-top: 1rem;
  padding: 1rem;
  border-radius: 4px;
  text-align: center;
}

.form-message.success {
  background: #e8f5e9;
  color: #2e7d32;
}

.form-message.error {
  background: #ffebee;
  color: #c62828;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Focus styles */
input:focus,
select:focus,
textarea:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.1);
}

/* Mobile optimization */
@media (max-width: 600px) {
  .contact-form {
    padding: 1.5rem;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  input,
  select,
  textarea {
    font-size: 16px; /* Prevent iOS zoom */
  }
}
</style>

<script>
const form = document.querySelector('.contact-form');
const submitButton = form.querySelector('.submit-button');
const formMessage = form.querySelector('.form-message');
const buttonText = submitButton.querySelector('.button-text');
const buttonLoader = submitButton.querySelector('.button-loader');

// Validation messages
const validationMessages = {
  name: {
    valueMissing: 'Please enter your name',
    tooShort: 'Name must be at least 2 characters'
  },
  email: {
    valueMissing: 'Please enter your email address',
    typeMismatch: 'Please enter a valid email address'
  },
  phone: {
    patternMismatch: 'Please enter a valid 10-digit phone number'
  },
  subject: {
    valueMissing: 'Please select a subject'
  },
  message: {
    valueMissing: 'Please enter your message',
    tooShort: 'Message must be at least 10 characters'
  },
  consent: {
    valueMissing: 'You must agree to the processing of your data'
  }
};

// Real-time validation
form.querySelectorAll('input, select, textarea').forEach(field => {
  field.addEventListener('input', () => validateField(field));
  field.addEventListener('blur', () => validateField(field));
});

function validateField(field) {
  const errorElement = document.getElementById(`${field.id}-error`);
  
  if (!field.validity.valid) {
    let message = '';
    for (const key in validationMessages[field.name]) {
      if (field.validity[key]) {
        message = validationMessages[field.name][key];
        break;
      }
    }
    errorElement.textContent = message;
    field.setAttribute('aria-invalid', 'true');
  } else {
    errorElement.textContent = '';
    field.setAttribute('aria-invalid', 'false');
  }
  
  // Update submit button state
  submitButton.disabled = !form.checkValidity();
}

// Form submission
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  if (!form.checkValidity()) {
    // Show all validation messages
    form.querySelectorAll('input, select, textarea').forEach(field => {
      validateField(field);
    });
    return;
  }
  
  // Show loading state
  submitButton.disabled = true;
  buttonText.hidden = true;
  buttonLoader.hidden = false;
  formMessage.className = 'form-message';
  formMessage.textContent = '';
  
  try {
    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    // Show success message
    formMessage.className = 'form-message success';
    formMessage.textContent = 'Thank you! Your message has been sent successfully.';
    form.reset();
  } catch (error) {
    // Show error message
    formMessage.className = 'form-message error';
    formMessage.textContent = 'Sorry, something went wrong. Please try again.';
  } finally {
    // Reset button state
    buttonText.hidden = false;
    buttonLoader.hidden = true;
    submitButton.disabled = false;
  }
});
</script>