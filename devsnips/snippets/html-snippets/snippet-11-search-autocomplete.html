<!--
  Search Bar with Autocomplete
  - Live search suggestions
  - Keyboard navigation support
  - Mobile-friendly design
  - ARIA roles and states
  - Minimal styling with smooth animations
-->

<form class="search-container" role="search">
  <div class="search-wrapper">
    <input 
      type="search" 
      class="search-input" 
      placeholder="Search..." 
      aria-label="Search"
      aria-expanded="false"
      aria-controls="search-suggestions"
      aria-autocomplete="list"
      autocomplete="off"
    >
    <button type="submit" class="search-button" aria-label="Submit search">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/>
      </svg>
    </button>
    
    <ul id="search-suggestions" class="search-suggestions" role="listbox" hidden>
      <!-- Demo suggestions -->
      <li role="option" tabindex="-1">
        <button type="button" class="suggestion-button">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z" fill="currentColor"/>
          </svg>
          <span>Search suggestion 1</span>
        </button>
      </li>
      <li role="option" tabindex="-1">
        <button type="button" class="suggestion-button">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z" fill="currentColor"/>
          </svg>
          <span>Search suggestion 2</span>
        </button>
      </li>
      <li role="option" tabindex="-1">
        <button type="button" class="suggestion-button">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z" fill="currentColor"/>
          </svg>
          <span>Search suggestion 3</span>
        </button>
      </li>
    </ul>
  </div>
</form>

<style>
.search-container {
  max-width: 600px;
  margin: 2rem auto;
  padding: 0 1rem;
}

.search-wrapper {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 0.75rem 3rem 0.75rem 1rem;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 1rem;
  transition: border-color 0.3s;
}

.search-input:focus {
  outline: none;
  border-color: #4a90e2;
  border-radius: 8px 8px 0 0;
}

.search-button {
  position: absolute;
  right: 0.5rem;
  top: 50%;
  transform: translateY(-50%);
  padding: 0.5rem;
  border: none;
  background: none;
  color: #666;
  cursor: pointer;
  transition: color 0.3s;
}

.search-button:hover {
  color: #333;
}

.search-suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  margin: 0;
  padding: 0;
  list-style: none;
  background: white;
  border: 2px solid #4a90e2;
  border-top: none;
  border-radius: 0 0 8px 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  z-index: 1000;
}

.suggestion-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  width: 100%;
  padding: 0.75rem 1rem;
  border: none;
  background: none;
  text-align: left;
  cursor: pointer;
  transition: background-color 0.3s;
}

.suggestion-button:hover,
.suggestion-button:focus {
  background-color: #f5f5f5;
}

/* Focus styles */
.search-button:focus-visible {
  outline: 2px solid #4a90e2;
  outline-offset: 2px;
  border-radius: 4px;
}

/* Mobile optimization */
@media (max-width: 600px) {
  .search-input {
    padding: 0.875rem 3rem 0.875rem 1rem;
  }
  
  .suggestion-button {
    padding: 1rem;
  }
}
</style>

<script>
const searchForm = document.querySelector('.search-container');
const searchInput = document.querySelector('.search-input');
const suggestionsList = document.querySelector('.search-suggestions');
const suggestions = document.querySelectorAll('[role="option"]');

// Toggle suggestions visibility
searchInput.addEventListener('input', (e) => {
  const hasValue = e.target.value.length > 0;
  suggestionsList.hidden = !hasValue;
  searchInput.setAttribute('aria-expanded', hasValue);
});

// Handle keyboard navigation
searchInput.addEventListener('keydown', (e) => {
  if (!['ArrowDown', 'ArrowUp', 'Escape'].includes(e.key)) return;
  
  e.preventDefault();
  
  if (e.key === 'Escape') {
    suggestionsList.hidden = true;
    searchInput.setAttribute('aria-expanded', 'false');
    return;
  }
  
  if (suggestionsList.hidden) {
    suggestionsList.hidden = false;
    searchInput.setAttribute('aria-expanded', 'true');
    suggestions[0].querySelector('button').focus();
    return;
  }
  
  const currentIndex = Array.from(suggestions).findIndex(
    suggestion => suggestion.contains(document.activeElement)
  );
  
  let nextIndex;
  if (e.key === 'ArrowDown') {
    nextIndex = currentIndex < suggestions.length - 1 ? currentIndex + 1 : 0;
  } else {
    nextIndex = currentIndex > 0 ? currentIndex - 1 : suggestions.length - 1;
  }
  
  suggestions[nextIndex].querySelector('button').focus();
});

// Close suggestions when clicking outside
document.addEventListener('click', (e) => {
  if (!searchForm.contains(e.target)) {
    suggestionsList.hidden = true;
    searchInput.setAttribute('aria-expanded', 'false');
  }
});

// Handle suggestion selection
suggestions.forEach(suggestion => {
  suggestion.querySelector('button').addEventListener('click', () => {
    searchInput.value = suggestion.textContent.trim();
    suggestionsList.hidden = true;
    searchInput.setAttribute('aria-expanded', 'false');
    searchInput.focus();
  });
});
</script>